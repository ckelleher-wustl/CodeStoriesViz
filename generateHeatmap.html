<!DOCTYPE html>
<html>

    <head>

        <script src="https://d3js.org/d3.v6.js"></script>

    </head>

    <body>
        
        <div id="my_dataviz"></div> 

        <script>
                    var file = d3.csv("before_after_test.csv");

                    // set the dimensions and margins of the graph
                    const margin = {top: 30, right: 30, bottom: 30, left: 30},
                      width = 650 - margin.left - margin.right,
                      height = 650 - margin.top - margin.bottom;

                    // append the svg object to the body of the page
                    const svg = d3.select("#my_dataviz")
                    //const svg = d3.select(content.querySelector("p"))
                    .append("svg")
                      .attr("width", width + margin.left + margin.right)
                      .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                      .attr("transform", `translate(${margin.left},${margin.top})`);

                    // Build X scales and axis:
                    const x = d3.scaleBand()
                      .range([ 0, width ])
                      .padding(0.01);
                    svg.append("g")
                      .attr("transform", `translate(0, ${height})`)
                      .call(d3.axisBottom(x))

                    //Read the data

                    file.then(function(data) {
                      
                      // Labels of row and columns
                      var lineNumbers = data.map(function(d) {return d.Line})

                      //Build Y scales and axis:
                      const y = d3.scaleBand()
                        .range([0, height ])
                        .domain(lineNumbers)
                        .padding(0.01);
                      svg.append("g")
                        .call(d3.axisLeft(y));

                      // Build color scale
                      const myColor = d3.scaleLinear()
                          .range(["#FFE5E5", "#FF0000"])
                          .domain([0,d3.max(data, function(d) { return +d.Changes; })])


                      svg.selectAll()
                          .data(data, function(d) {return d.Line})
                          .join("rect")
                          .attr("x", function(d) { return x(d.Line) })
                          .attr("y", function(d) { return y(d.Line) })
                          .attr("width", x.bandwidth() )
                          .attr("height", y.bandwidth() )
                          .style("fill", function(d) { return myColor(d.Changes)} )

                      //adding text annotations of lines of code on top of each row of the heatmap
                      var bar = svg
                          .selectAll(".label")
                          .data(data)
                          .enter()
                          .append("g")
                          .attr("class", "label")
                          .style("font", "13px times")
                          .attr("transform", "translate(8,11.1)");
                        bar
                          .append("text")
                          .attr("x", (d) => x(d.Line))
                          .attr("y", (d) => y(d.Line))
                          .text((d) => d.Text);


                      svg.append("text")
                          .attr("class", "ylabel")
                          .attr("text-anchor", "end")
                          .attr("x", -208)
                          .attr("y", -56)
                          .attr("dy", ".75em")
                          .attr("transform", "rotate(-90)")
                          .text("Line Number");

                    })

          </script>
    </body>

</html>